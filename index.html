<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lucknow AQI & Weather Dashboard</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>Lucknow AQI & Weather Dashboard</h1>
  </header>

  <main>
    <section class="card" id="aqi-info">
      <h2>Air Quality Index (AQI)</h2>
      <p>Live AQI: <span id="aqi">Loading...</span></p>
      <p>PM2.5: <span id="pm25">--</span> µg/m³</p>
      <p>PM10: <span id="pm10">--</span> µg/m³</p>
    </section>

    <section class="card" id="weather-info">
      <h2>Current Weather</h2>
      <p>Temperature: <span id="temperature">--</span>°C</p>
      <p>Humidity: <span id="humidity">--</span>%</p>
      <p>Wind Speed: <span id="wind-speed">--</span> km/h</p>
    </section>

    <section class="card" id="traffic-info">
      <h2>Traffic Incidents</h2>
      <ul id="traffic-list">
        <li>Loading...</li>
      </ul>
    </section>
  </main>

  <footer>
    <p>Powered by Open-Meteo & TomTom</p>
  </footer>

  <script>
    const lat = 26.8467;
    const lon = 80.9462;

    // Weather API
    fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`)
      .then(res => res.json())
      .then(data => {
        const weather = data.current_weather;
        document.getElementById("temperature").textContent = weather.temperature;
        document.getElementById("wind-speed").textContent = weather.windspeed;
      });

    // AQI API
    fetch(`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${lat}&longitude=${lon}&hourly=pm2_5,pm10`)
      .then(res => res.json())
      .then(data => {
        const latestIndex = data.hourly.time.length - 1;
        const pm25 = data.hourly.pm2_5[latestIndex];
        const pm10 = data.hourly.pm10[latestIndex];
        const aqi = Math.max(pm25 * 2, pm10); // Simple AQI logic

        document.getElementById("pm25").textContent = pm25;
        document.getElementById("pm10").textContent = pm10;
        document.getElementById("aqi").textContent = Math.round(aqi);
      });

    // TomTom API for Traffic
    const apiKey = "OSs8MdHT9bfR1pKKwHq8ErBcuNgZGMFA";
    const bbox = "80.90,26.84,81.00,26.88"; // Approx bbox for Lucknow

    fetch(`https://api.tomtom.com/traffic/services/5/incidentDetails?key=${apiKey}&bbox=${bbox}&fields=ALL&language=en`)
      .then(res => res.json())
      .then(data => {
        const list = document.getElementById("traffic-list");
        list.innerHTML = "";

        if (data.incidents && data.incidents.length > 0) {
          data.incidents.forEach(incident => {
            const li = document.createElement("li");
            li.textContent = incident.properties.eventDescription;
            list.appendChild(li);
          });
        } else {
          list.innerHTML = "<li>No incidents currently.</li>";
        }
      });
  </script>
</body>
</html>
