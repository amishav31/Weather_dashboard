<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lucknow AQI Dashboard</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

  <!-- Font Awesome for icons -->
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
    body {
      background: linear-gradient(135deg, #0f172a, #1e293b);
      color: #fff;
      padding: 2rem;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.5s ease;
    }
    .container {
      width: 100%;
      max-width: 600px;
      background: #111827;
      padding: 2rem;
      border-radius: 20px;
      box-shadow: 0 0 20px rgba(0,255,0,0.5);
      text-align: center;
      opacity: 0;
      animation: fadeIn 1s forwards;
    }
    h1 {
      font-size: 1.8rem;
      color: #60a5fa;
      margin-bottom: 1rem;
    }
    .aqi-box {
      background: #1f2937;
      padding: 2rem;
      border-radius: 15px;
      margin-bottom: 1rem;
      opacity: 0;
      animation: fadeIn 1s forwards 0.5s;
    }
    .aqi-value {
      font-size: 3.5rem;
      font-weight: bold;
      color: white;
      transition: color 0.5s ease;
    }
    .status {
      display: inline-block;
      margin: 10px auto;
      padding: 5px 15px;
      border-radius: 20px;
      font-weight: bold;
      font-size: 1.1rem;
      transition: background-color 0.5s ease, color 0.5s ease;
    }
    .pm-info {
      margin-top: 1rem;
      color: #9ca3af;
      font-size: 0.9rem;
    }
    .scale-bar { display: flex; margin: 1.5rem 0 0.5rem; height: 10px; border-radius: 5px; overflow: hidden; }
    .scale-bar div { flex: 1; }
    .green { background: #22c55e; }
    .yellow { background: #facc15; }
    .orange { background: #fb923c; }
    .red { background: #ef4444; }
    .purple { background: #8b5cf6; }
    .maroon { background: #7f1d1d; }
    .scale-numbers { display: flex; justify-content: space-between; font-size: 0.8rem; color: #9ca3af; margin-top: 0.5rem; }
    .weather-stats { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 1.5rem; color: #cbd5e1; }
    .traffic-updates { background: #1f2937; margin-top: 1.5rem; padding: 1rem; border-radius: 10px; opacity: 0; animation: fadeIn 1s forwards 1s; }
    .traffic-updates h2 { font-size: 1.2rem; color: #60a5fa; margin-bottom: 10px; }
    .traffic-updates ul { list-style-type: disc; padding-left: 20px; color: #cbd5e1; }
    .last-updated { margin-top: 1.5rem; font-size: 0.8rem; color: #9ca3af; }

    @keyframes fadeIn {
      0% { opacity: 0; }
      100% { opacity: 1; }
    }
    
    @media(max-width: 600px) { .info-grid { flex-direction: column; } }
  </style>
</head>
<body>
  <div class="container">
    <h1>Lucknow Air Quality Index (AQI)</h1>

    <div class="aqi-box" id="aqi-card">
      <div id="aqi-value" class="aqi-value">--</div>
      <div id="aqi-status" class="status">--</div>
      <div class="pm-info">
        <p>PM10: <span id="pm10">--</span> ¬µg/m¬≥</p>
        <p>PM2.5: <span id="pm25">--</span> ¬µg/m¬≥</p>
      </div>

      <div class="scale-bar">
        <div class="green"></div>
        <div class="yellow"></div>
        <div class="orange"></div>
        <div class="red"></div>
        <div class="purple"></div>
        <div class="maroon"></div>
      </div>

      <div class="scale-numbers">
        <span>0</span><span>50</span><span>100</span><span>150</span><span>200</span><span>300+</span>
      </div>
    </div>

    <div class="weather-stats">
      <div>üå°Ô∏è Temperature: <span id="temperature">--</span>¬∞C</div>
      <div>üíß Humidity: <span id="humidity">--</span>%</div>
      <div>üå¨Ô∏è Wind Speed: <span id="wind">--</span> km/h</div>
      <div>üåû UV Index: <span id="uv">--</span></div>
    </div>

    <div class="traffic-updates">
      <h2>Traffic Updates</h2>
      <ul id="traffic-list">
        <li>Loading...</li>
      </ul>
    </div>

    <div id="last-updated" class="last-updated">Last updated: --</div>
  </div>

  <script>
    const weatherAPI = "https://api.open-meteo.com/v1/forecast?latitude=26.8467&longitude=80.9462&current_weather=true&hourly=uv_index,relativehumidity_2m";
    const airQualityAPI = "https://air-quality-api.open-meteo.com/v1/air-quality?latitude=26.8467&longitude=80.9462&hourly=pm2_5,pm10";
    const trafficAPI = "https://api.tomtom.com/traffic/services/5/incidentDetails?key=OSs8MdHT9bfR1pKKwHq8ErBcuNgZGMFA&bbox=80.9000,26.8000,81.0000,26.9000";

    function calculateAQI(pm25) {
      let C_low, C_high, I_low, I_high;
      if (pm25 <= 30) {
        C_low = 0; C_high = 30; I_low = 0; I_high = 50;
      } else if (pm25 <= 60) {
        C_low = 31; C_high = 60; I_low = 51; I_high = 100;
      } else if (pm25 <= 90) {
        C_low = 61; C_high = 90; I_low = 101; I_high = 200;
      } else if (pm25 <= 120) {
        C_low = 91; C_high = 120; I_low = 201; I_high = 300;
      } else if (pm25 <= 250) {
        C_low = 121; C_high = 250; I_low = 301; I_high = 400;
      } else if (pm25 <= 500) {
        C_low = 251; C_high = 500; I_low = 401; I_high = 500;
      } else {
        return 500;
      }
      const AQI = ((I_high - I_low) / (C_high - C_low)) * (pm25 - C_low) + I_low;
      return Math.round(AQI);
    }

    async function fetchWeather() {
      try {
        const res = await fetch(weatherAPI);
        const data = await res.json();
        const current = data.current_weather;

        document.getElementById('temperature').textContent = current.temperature;
        document.getElementById('wind').textContent = current.windspeed;
        document.getElementById('humidity').textContent = data.hourly.relativehumidity_2m[0];
        document.getElementById('uv').textContent = data.hourly.uv_index[0];
      } catch (error) {
        console.error('Weather fetch error:', error);
      }
    }

    async function fetchAirQuality() {
      try {
        const res = await fetch(airQualityAPI);
        const data = await res.json();
        const pm25 = data.hourly.pm2_5[0];
        const pm10 = data.hourly.pm10[0];

        const aqi = calculateAQI(pm25);
        let status = "", bgColor = "";

        if (aqi <= 50) {
          status = "Good üòä"; bgColor = "#22c55e";
        } else if (aqi <= 100) {
          status = "Moderate üòê"; bgColor = "#facc15";
        } else if (aqi <= 150) {
          status = "Sensitive üò∑"; bgColor = "#fb923c";
        } else if (aqi <= 200) {
          status = "Unhealthy ü™¢"; bgColor = "#ef4444";
        } else if (aqi <= 300) {
          status = "Very Unhealthy üò®"; bgColor = "#8b5cf6";
        } else {
          status = "Hazardous ‚ò†Ô∏è"; bgColor = "#7f1d1d";
        }

        document.getElementById('aqi-value').textContent = aqi;
        document.getElementById('pm25').textContent = pm25.toFixed(1);
        document.getElementById('pm10').textContent = pm10.toFixed(1);
        document.getElementById('aqi-status').textContent = status;
        document.getElementById('aqi-status').style.backgroundColor = bgColor;
        document.getElementById('aqi-card').style.boxShadow = `0 0 20px ${bgColor}80`;

        const now = new Date();
        document.getElementById('last-updated').textContent = "Last updated: " + now.toLocaleTimeString();
      } catch (error) {
        console.error('Air Quality fetch error:', error);
      }
    }

    async function fetchTraffic() {
      try {
        const res = await fetch(trafficAPI);
        const data = await res.json();
        const incidents = data.incidentDetails || [];
        const list = document.getElementById('traffic-list');

        if (incidents.length === 0) {
          list.innerHTML = '<li>No major incidents üöó</li>';
        } else {
          list.innerHTML = incidents.slice(0, 3).map(inc => `<li>${inc.properties.eventDescription || 'Traffic Update'}</li>`).join('');
        }
      } catch (error) {
        console.error('Traffic fetch error:', error);
        document.getElementById('traffic-list').innerHTML = '<li>Traffic data unavailable üöß</li>';
      }
    }

    async function initDashboard() {
      await fetchWeather();
      await fetchAirQuality();
      await fetchTraffic();
    }

    initDashboard();
    setInterval(initDashboard, 5 * 60 * 1000); // Every 5 minutes
  </script>
</body>
</html>
